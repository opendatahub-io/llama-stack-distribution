FROM registry.access.redhat.com/ubi9/python-312@sha256:95ec8d3ee9f875da011639213fd254256c29bc58861ac0b11f290a291fa04435
WORKDIR /opt/app-root

RUN pip install sqlalchemy # somehow sqlalchemy[asyncio] is not sufficient
{dependencies}
RUN pip install --no-cache llama-stack==0.2.18
RUN mkdir -p ${{HOME}}/.llama/providers.d ${{HOME}}/.cache

# Copy both configurations
COPY distribution/run.yaml ${{APP_ROOT}}/run-full.yaml
COPY distribution/run-standalone.yaml ${{APP_ROOT}}/run-standalone.yaml

# Copy the entrypoint script
COPY --chmod=755 distribution/entrypoint.sh ${{APP_ROOT}}/entrypoint.sh

# Copy providers directory (will be filtered by entrypoint script)
COPY distribution/providers.d/ ${{HOME}}/.llama/providers.d/

ENTRYPOINT ["/opt/app-root/entrypoint.sh"]
